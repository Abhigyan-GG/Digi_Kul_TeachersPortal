{% extends 'base.html' %}
{% block title %}{{ get_translation('Login', session.get('language', 'en')) }} • {{ get_translation('Digi Kul', session.get('language', 'en')) }}{% endblock %}
{% block content %}
<div class="login-container" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); position: relative; overflow: hidden; margin: -2rem -1rem; padding: 2rem 1rem;">
  <!-- Background Elements -->
  <div class="bg-elements" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 1;">
    <div class="bg-circle" style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 6s ease-in-out infinite;"></div>
    <div class="bg-circle" style="position: absolute; bottom: -80px; left: -80px; width: 300px; height: 300px; background: rgba(255,255,255,0.05); border-radius: 50%; animation: float 8s ease-in-out infinite reverse;"></div>
    <div class="bg-circle" style="position: absolute; top: 50%; left: 10%; width: 100px; height: 100px; background: rgba(255,255,255,0.08); border-radius: 50%; animation: float 4s ease-in-out infinite;"></div>
  </div>
  
  <div class="card" style="max-width: 450px; margin: 2rem; position: relative; z-index: 2; backdrop-filter: blur(10px); background: rgba(255,255,255,0.95); border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 25px 50px rgba(0,0,0,0.15);">
    <!-- Language Switcher for Login Page -->
    <div style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
      <select onchange="changeLanguage(this.value)" style="background: rgba(255,255,255,0.9); color: var(--gray-700); border: 1px solid var(--gray-300); padding: 0.5rem; border-radius: 0.5rem; font-size: 0.875rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <option value="en" {% if session.get('language', 'en') == 'en' %}selected{% endif %}>🇺🇸 English</option>
        <option value="hi" {% if session.get('language', 'en') == 'hi' %}selected{% endif %}>🇮🇳 हिन्दी</option>
      </select>
    </div>
    
    <div class="card-header" style="text-align: center; padding: 2rem 2rem 1rem 2rem;">
      <div class="logo-container" style="margin-bottom: 1rem;">
        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 20px; margin: 0 auto; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);">
          <span style="font-size: 2.5rem; color: white;">🎓</span>
        </div>
      </div>
      <h2 class="card-title" style="margin-bottom: 0.5rem; color: var(--gray-900);">{% if admin_mode %}{{ get_translation('Admin Login', session.get('language', 'en')) }}{% else %}{{ get_translation('Welcome Back', session.get('language', 'en')) }}{% endif %}</h2>
      <p class="card-subtitle" style="color: var(--gray-600);">{% if admin_mode %}{{ get_translation('Access admin dashboard', session.get('language', 'en')) }}{% else %}{{ get_translation('Sign in to your Digi Kul account', session.get('language', 'en')) }}{% endif %}</p>
    </div>
    <div class="card-body" style="padding: 1rem 2rem 2rem 2rem;">
      <form id="loginForm" onsubmit="login(event)">
        <div class="form-group">
          <label for="email" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
            <span style="font-size: 1.2rem;">📧</span>
            {{ get_translation('Email Address', session.get('language', 'en')) }}
          </label>
          <input type="email" name="email" id="email" placeholder="{{ get_translation('Enter your email address', session.get('language', 'en')) }}" required style="padding: 1rem; border: 2px solid var(--gray-200); border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: var(--gray-50);" />
        </div>
        <div class="form-group">
          <label for="password" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
            <span style="font-size: 1.2rem;">🔒</span>
            {{ get_translation('Password', session.get('language', 'en')) }}
          </label>
          <div style="position: relative;">
            <input type="password" name="password" id="password" placeholder="{{ get_translation('Enter your password', session.get('language', 'en')) }}" required style="padding: 1rem; border: 2px solid var(--gray-200); border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: var(--gray-50); width: 100%;" />
            <button type="button" onclick="togglePassword()" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--gray-500);">👁️</button>
          </div>
        </div>
        {% if admin_mode %}
          <input type="hidden" id="user_type" value="admin" />
        {% else %}
          <div class="form-group">
            <label for="user_type" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-weight: 600; color: var(--gray-700);">
              <span style="font-size: 1.2rem;">👤</span>
              {{ get_translation('User Type', session.get('language', 'en')) }}
            </label>
            <select id="user_type" required style="padding: 1rem; border: 2px solid var(--gray-200); border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: var(--gray-50); width: 100%;">
              <option value="">{{ get_translation('Select your role', session.get('language', 'en')) }}</option>
              <option value="teacher">👨‍🏫 {{ get_translation('Teacher', session.get('language', 'en')) }}</option>
              <option value="student">👨‍🎓 {{ get_translation('Student', session.get('language', 'en')) }}</option>
            </select>
          </div>
        {% endif %}
        <div class="form-group" style="margin-top: 1.5rem;">
          <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, var(--primary), var(--secondary)); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
            <span style="margin-right: 0.5rem;">🚀</span>
            {{ get_translation('Sign In', session.get('language', 'en')) }}
          </button>
        </div>
      </form>
      <div id="loginError" class="alert error" style="display:none; margin-top: 1rem; border-radius: 12px; padding: 1rem;"></div>
      
      {% if not admin_mode %}
      <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200);">
        <p style="color: var(--gray-600); margin-bottom: 0.5rem;">{{ get_translation('Need admin access?', session.get('language', 'en')) }}</p>
        <a href="/admin_login" style="color: var(--primary); text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 8px; background: rgba(102, 126, 234, 0.1); transition: all 0.3s ease;">
          <span>🔑</span>
          {{ get_translation('Admin Login', session.get('language', 'en')) }}
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.login-container input:focus,
.login-container select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  background: var(--white);
}

.login-container .btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
}

.bg-elements .bg-circle {
  animation-duration: 6s;
}

.bg-elements .bg-circle:nth-child(2) {
  animation-duration: 8s;
  animation-delay: -2s;
}

.bg-elements .bg-circle:nth-child(3) {
  animation-duration: 4s;
  animation-delay: -1s;
}
</style>

<script>
function togglePassword() {
  const passwordInput = document.getElementById('password');
  const toggleButton = passwordInput.nextElementSibling;
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleButton.textContent = '🙈';
  } else {
    passwordInput.type = 'password';
    toggleButton.textContent = '👁️';
  }
}

async function login(e){
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const user_type = document.getElementById('user_type').value;
  const errorBox = document.getElementById('loginError');
  const submitButton = document.querySelector('button[type="submit"]');
  
  errorBox.style.display = 'none';
  
  // Add loading state
  const originalText = submitButton.innerHTML;
  submitButton.innerHTML = '<span style="margin-right: 0.5rem;">⏳</span>Signing In...';
  submitButton.disabled = true;
  
  try {
    const res = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'same-origin',
      body: JSON.stringify({ email, password, user_type })
    });
    const data = await res.json();
    if (!res.ok || !data.success){
      errorBox.textContent = data.error || 'Login failed';
      errorBox.style.display = 'block';
      return;
    }
    
    // Success animation
    submitButton.innerHTML = '<span style="margin-right: 0.5rem;">✅</span>Success!';
    submitButton.style.background = 'linear-gradient(135deg, var(--success), #059669)';
    
    setTimeout(() => {
      window.location.href = data.redirect_url || '/';
    }, 1000);
    
  } catch (err){
    errorBox.textContent = 'Network error';
    errorBox.style.display = 'block';
  } finally {
    // Reset button state
    setTimeout(() => {
      submitButton.innerHTML = originalText;
      submitButton.disabled = false;
      submitButton.style.background = 'linear-gradient(135deg, var(--primary), var(--secondary))';
    }, 2000);
  }
}
</script>
{% endblock %}



